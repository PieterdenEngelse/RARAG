

#!/bin/bash

GITHUB_USERNAME="PieterdenEngelse"
GITHUB_TOKEN="${GITHUB_TOKEN}"

if [[ -z "$GITHUB_TOKEN" ]]; then
  echo "‚ùå Error: Please set the GITHUB_TOKEN environment variable."
  exit 1
fi

echo "‚ö†Ô∏è  This will delete ALL repositories owned by $GITHUB_USERNAME."
read -p "Type 'DELETE ALL' to confirm: " confirm
if [[ "$confirm" != "DELETE ALL" ]]; then
  echo "Aborted."
  exit 1
fi

page=1
while true; do
  repos=$(curl -s -H "Authorization: token $GITHUB_TOKEN" \
    "https://api.github.com/user/repos?type=owner&per_page=100&page=$page")

  repo_count=$(echo "$repos" | jq -r 'length')
  if [[ "$repo_count" -eq 0 ]] || [[ "$repo_count" == "null" ]]; then
    break
  fi

  echo "$repos" | jq -r '.[].name' | while read -r repo; do
    if [[ -n "$repo" ]]; then
      echo "üóëÔ∏è Deleting repository: $repo"
      response=$(curl -s -o /dev/null -w "%{http_code}" -X DELETE \
        -H "Authorization: token $GITHUB_TOKEN" \
        "https://api.github.com/repos/$GITHUB_USERNAME/$repo")
      if [[ "$response" == "204" ]]; then
        echo "‚úÖ Successfully deleted $repo"
      else
        echo "‚ùå Failed to delete $repo (HTTP $response)"
      fi
    fi
  done

  ((page++))
done

echo "‚úÖ Done. All owned repositories have been processed."
