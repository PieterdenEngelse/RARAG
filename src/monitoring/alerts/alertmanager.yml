global:
  resolve_timeout: 5m
  # SMTP settings for email notifications (REPLACE with real values)
  smtp_smarthost: 'smtp.example.com:587'
  smtp_from: 'alertmanager@example.com'
  smtp_auth_username: 'user@example.com'
  smtp_auth_password: 'REPLACE_WITH_REAL_PASSWORD'
  # Optional: smtp_require_tls: true

route:
  # Group alerts by these labels
  group_by: ['alertname', 'service']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 3h

  # Default receiver if no child route matches
  receiver: 'default'

  # Child routes for specific services/components
  routes:
    # Route for Vector → Loki alerts (service=ag-backend, component=vector-loki)
    - matchers:
        - service="ag-backend"
        - component="vector-loki"
      receiver: 'vector-loki'
      group_wait: 30s
      group_interval: 2m
      repeat_interval: 1h

    # Route for critical alerts across services
    - matchers:
        - severity="critical"
      receiver: 'critical'
      continue: false

receivers:
  # Default receiver: UI only (no email) – alerts appear in Alertmanager web UI
  - name: 'default'
    # No email/webhook configs here – good for dev and non-urgent alerts

  # Receiver for Vector → Loki alerts
  - name: 'vector-loki'
    email_configs:
      - to: 'ops+vector-loki@example.com'   # REPLACE with your list address
        send_resolved: true
        headers:
          Subject: '[Alertmanager] Vector → Loki alert'

  # Receiver for critical alerts (any service)
  - name: 'critical'
    email_configs:
      - to: 'oncall@example.com'            # REPLACE with your on-call address
        send_resolved: true
        headers:
          Subject: '[Alertmanager] CRITICAL alert'

# (Optional) Inhibit rules to avoid duplicate noise
inhibit_rules:
  # If a critical alert for the same service is firing, suppress lower-severity ones
  - source_matchers: ['severity="critical"']
    target_matchers: ['severity!="critical"']
    equal: ['service']
