use crate::memory::AgentMemory;
use crate::retrieval::Retriever;

#[allow(dead_code)]
pub enum QueryIntent {
    StructuredRecall,
    KeywordSearch,
    HybridRetrieval,
}

pub struct Dispatcher {
    pub memory: AgentMemory,
    pub retriever: Retriever,
}

impl Dispatcher {
    pub fn new(memory: AgentMemory, retriever: Retriever) -> Self {
        Self { memory, retriever }
    }

    pub fn handle(&self, intent: QueryIntent, agent_id: &str, query: &str) -> Vec<String> {
        match intent {
            QueryIntent::StructuredRecall => self.memory.recall(agent_id).unwrap_or_default(),
            QueryIntent::KeywordSearch => self.retriever.search(query),
            QueryIntent::HybridRetrieval => {
                let hits = self.retriever.search(query);
                let mut context = self.memory.recall(agent_id).unwrap_or_default();
                context.extend(hits);
                context
            }
        }
    }
}